<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <title>Notificaciones - Artesanos.com</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="icon" href="/favicon.png" type="image/png">
</head>

<body class="min-h-screen"
    style="background-image: url('/fondo.png'); background-size: cover; background-repeat: no-repeat; background-position: center; background-attachment: fixed;">
    <%- include('partials/navbar') %>

        <div class="fixed inset-0 backdrop-blur-md bg-black/10 z-0"></div>

        <div class="relative z-10 container mx-auto pt-20 md:pt-24 pb-12 px-4 max-w-2xl">
            <div class="flex flex-col md:flex-row justify-between items-center gap-6 mb-10">
                <div class="text-center md:text-left">
                    <h2 class="text-3xl md:text-4xl font-black text-white tracking-tight">Notificaciones</h2>
                    <p class="text-cyan-400/60 text-sm font-bold uppercase tracking-widest mt-1">Actividad reciente</p>
                </div>
                <form action="/notificaciones/leer-todas" method="POST" class="w-full md:w-auto">
                    <button type="submit"
                        class="w-full md:w-auto bg-gradient-to-r from-cyan-500/10 to-cyan-500/20 text-cyan-400 hover:from-cyan-500 hover:to-cyan-600 hover:text-white transition-all text-[10px] font-black uppercase tracking-[0.2em] border border-cyan-400/30 px-8 py-4 rounded-2xl shadow-xl shadow-cyan-900/20 active:scale-95">
                        Marcar todas como leídas
                    </button>
                </form>
            </div>

            <div class="flex flex-col gap-5">
                <% if (notificaciones.length> 0) { %>
                    <% notificaciones.forEach(n=> { %>
                        <div
                            class="group relative overflow-hidden bg-black/40 backdrop-blur-xl border <%= n.leida ? 'border-white/5 opacity-80' : 'border-cyan-400/30 bg-cyan-900/10 shadow-lg shadow-cyan-500/5' %> rounded-3xl p-5 flex flex-col sm:flex-row justify-between items-start sm:items-center gap-5 transition-all hover:border-cyan-400/50 hover:bg-black/60">

                            <!-- Indicador de no leído -->
                            <% if (!n.leida) { %>
                                <div
                                    class="absolute top-0 left-0 w-1 h-full bg-cyan-400 shadow-[0_0_15px_rgba(34,211,238,0.5)]">
                                </div>
                                <% } %>

                                    <div class="flex items-start md:items-center gap-5 w-full">
                                        <div
                                            class="w-14 h-14 shrink-0 rounded-2xl flex items-center justify-center transition-transform group-hover:scale-110 <%= n.tipo === 'comentario' ? 'bg-orange-500/10 text-orange-400 border border-orange-500/20' : 'bg-cyan-500/10 text-cyan-400 border border-cyan-500/20' %>">
                                            <% if (n.tipo==='comentario' ) { %>
                                                <svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7" fill="none"
                                                    viewBox="0 0 24 24" stroke="currentColor">
                                                    <path stroke-linecap="round" stroke-linejoin="round"
                                                        stroke-width="1.5"
                                                        d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z" />
                                                </svg>
                                                <% } else { %>
                                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7" fill="none"
                                                        viewBox="0 0 24 24" stroke="currentColor">
                                                        <path stroke-linecap="round" stroke-linejoin="round"
                                                            stroke-width="1.5"
                                                            d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z" />
                                                    </svg>
                                                    <% } %>
                                        </div>
                                        <div class="flex-1 min-w-0">
                                            <p
                                                class="text-white text-base md:text-lg leading-snug <%= n.leida ? 'text-white/60' : 'font-bold' %>">
                                                <%= n.mensaje %>
                                            </p>
                                            <div class="flex flex-wrap items-center gap-4 mt-3">
                                                <% if (!n.leida && n.tipo==='amistad' && n.mensaje.includes('te ha')) {
                                                    %>
                                                    <div class="flex gap-2 w-full sm:w-auto">
                                                        <form action="/amistades/actualizar" method="POST"
                                                            class="flex-1 sm:flex-none">
                                                            <input type="hidden" name="id_amistad"
                                                                value="<%= n.id_referencia %>">
                                                            <input type="hidden" name="accion" value="aceptar">
                                                            <button type="submit"
                                                                class="w-full bg-cyan-500 text-white text-[10px] font-black uppercase tracking-widest px-6 py-2.5 rounded-xl hover:bg-cyan-400 hover:scale-105 transition-all shadow-lg shadow-cyan-500/20">Aceptar</button>
                                                        </form>
                                                        <form action="/amistades/actualizar" method="POST"
                                                            class="flex-1 sm:flex-none">
                                                            <input type="hidden" name="id_amistad"
                                                                value="<%= n.id_referencia %>">
                                                            <input type="hidden" name="accion" value="rechazar">
                                                            <button type="submit"
                                                                class="w-full bg-white/5 text-white/60 text-[10px] font-black uppercase tracking-widest px-6 py-2.5 rounded-xl hover:bg-red-500/20 hover:text-red-400 border border-white/10 hover:border-red-500/30 transition-all">Rechazar</button>
                                                        </form>
                                                    </div>
                                                    <% } else if (n.tipo==='comentario' ) { %>
                                                        <a href="/albumes/ver-imagen-notif/<%= n.id_referencia %>"
                                                            class="inline-flex items-center gap-2 text-cyan-400 text-xs font-black uppercase tracking-widest hover:text-white transition-all group/link">
                                                            <span>Ver imagen</span>
                                                            <span
                                                                class="transform group-hover/link:translate-x-1 transition-transform">&rarr;</span>
                                                        </a>
                                                        <% } %>
                                                            <span
                                                                class="text-[10px] uppercase font-black text-white/20 tracking-tighter">
                                                                <%= new Date(n.creada_en).toLocaleString() %>
                                                            </span>
                                            </div>
                                        </div>
                                    </div>

                                    <% if (!n.leida) { %>
                                        <button onclick="marcarLeida('<%= n.id_notificacion %>')"
                                            class="absolute top-4 right-4 sm:relative sm:top-auto sm:right-auto text-cyan-400/40 hover:text-cyan-400 p-2 transition-colors sm:opacity-0 group-hover:opacity-100"
                                            title="Marcar como leída">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none"
                                                viewBox="0 0 24 24" stroke="currentColor">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                    d="M5 13l4 4L19 7" />
                                            </svg>
                                        </button>
                                        <% } %>
                        </div>
                        <% }) %>
                            <% } else { %>
                                <div
                                    class="bg-black/20 backdrop-blur-md p-16 rounded-[2.5rem] border border-white/5 text-center flex flex-col items-center gap-4">
                                    <div
                                        class="w-20 h-20 bg-white/5 rounded-full flex items-center justify-center text-white/20 mb-2">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10" fill="none"
                                            viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1"
                                                d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4" />
                                        </svg>
                                    </div>
                                    <p class="text-white/40 italic text-xl font-medium tracking-tight">Todo al día por
                                        aquí</p>
                                </div>
                                <% } %>
            </div>
        </div>

        <%- include('partials/icons') %>

            <script>
                async function marcarLeida(id) {
                    try {
                        const res = await fetch(`/notificaciones/${id}/leer`, { method: 'POST' });
                        if (res.ok) {
                            location.reload();
                        }
                    } catch (err) {
                        console.error(err);
                    }
                }
            </script>
</body>

</html>